<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Add Money</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{
    font-family:'Poppins', sans-serif;
    margin:0;
    padding:0;
    background:linear-gradient(145deg,#e8f0ff,#fff1f1,#ffe7db);
    color:#222;
    min-height:100vh;
}

/* ======= FULL SCREEN LOADING OVERLAY ======= */
#loadingOverlay{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    backdrop-filter:blur(6px);
    background:rgba(255,255,255,0.6);
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:20px;
    font-weight:700;
    color:#1e90ff;
    z-index:99999;
}

/* HEADER */
.header{
    padding:12px 15px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    color:white;
    background:rgba(30,144,255,0.85);
    backdrop-filter:blur(12px);
    box-shadow:0 4px 20px rgba(0,0,0,0.25);
    position:sticky;
    top:0;
    z-index:100;
}
.logo{
    display:flex;
    align-items:center;
    gap:8px;
    font-size:20px;
    font-weight:700;
    cursor:pointer;
}
.logo img{
    height:42px;
}

.container{
    max-width:480px;
    margin:auto;
    padding:18px;
}
.card{
    background:white;
    padding:24px;
    border-radius:18px;
    box-shadow:0 5px 20px rgba(0,0,0,0.15);
}
h2{
    text-align:center;
    margin-bottom:16px;
    font-size:24px;
    font-weight:700;
}
input{
    width:100%;
    padding:14px;
    border-radius:12px;
    border:1px solid #ddd;
    background:#f7f7f7;
    color:#333;
    font-size:15px;
    margin-top:8px;
}
.method-box{
    display:flex;
    gap:12px;
    margin-top:14px;
}
.method{
    flex:1;
    padding:14px;
    background:#f3f6ff;
    border-radius:14px;
    text-align:center;
    border:2px solid transparent;
    cursor:pointer;
    font-weight:600;
}
.method.active{
    border-color:#1e90ff;
    background:#e8f1ff;
    box-shadow:0 0 10px rgba(30,144,255,0.5);
}
.copy-btn, .submit-btn{
    width:100%;
    padding:14px;
    margin-top:12px;
    border-radius:12px;
    font-size:16px;
    border:none;
    cursor:pointer;
    font-weight:700;
}
.copy-btn{
    background:#e1e1e1;
}
.submit-btn{
    background:#1e90ff;
    color:white;
    box-shadow:0 0 12px rgba(30,144,255,0.6);
}
.balance{
    text-align:center;
    font-size:15px;
    color:#1e90ff;
    margin-bottom:12px;
}

/* Bottom Menu */
.bottom-menu{
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:white;
    display:flex;
    justify-content:space-around;
    padding:12px 0;
    box-shadow:0 -4px 18px rgba(0,0,0,0.2);
    z-index:200;
}
.bottom-menu div{
    text-align:center;
    font-size:12px;
    font-weight:700;
    cursor:pointer;
}

/* === CUSTOM POPUP === */
#customPopup{
    position: fixed;
    top:50%;
    left:50%;
    transform: translate(-50%, -50%) scale(0.8);
    background:white;
    padding:22px 25px;
    border-radius:16px;
    box-shadow:0 8px 25px rgba(0,0,0,0.25);
    width:260px;
    text-align:center;
    font-size:16px;
    font-weight:600;
    z-index:9999;
    opacity:0;
    display:none;
    transition:0.3s ease-in-out;
}
#popupBtn{
    margin-top:14px;
    background:#1e90ff;
    color:white;
    border:none;
    padding:10px 18px;
    border-radius:10px;
    font-size:15px;
    cursor:pointer;
    font-weight:700;
}
</style>
</head>

<body>

<!-- FULL SCREEN LOADING -->
<div id="loadingOverlay">‚è≥ Please Wait... Loading...</div>

<!-- CUSTOM POPUP -->
<div id="customPopup">
    <p id="popupMessage"></p>
    <button id="popupBtn" onclick="closePopup()">OK</button>
</div>

<!-- HEADER -->
<div class="header">
    <div class="logo" onclick="openHome()">
        <img src="logo.png">
        <span>TOPUP BD</span>
    </div>
</div>

<!-- ADD MONEY SECTION -->
<div class="container">
<div class="card">

<h2>üí∞ Add Money</h2>

<p id="myDeposit" class="balance">Your Deposit Balance: Loading...</p>

<label>Amount</label>
<input id="amount" type="number" placeholder="Enter Amount">

<label style="margin-top:12px;display:block;">Your Mobile Number</label>
<input id="userPhone" type="number" placeholder="Enter your mobile number">

<div class="method-box">
    <div id="bkashTab" class="method active" onclick="setMethod('bkash')">Bkash</div>
    <div id="nagadTab" class="method" onclick="setMethod('nagad')">Nagad</div>
</div>

<label style="margin-top:12px;display:block;">Send Money To</label>
<input id="payNumber" readonly placeholder="Loading...">

<button class="copy-btn" onclick="copyNumber()">Copy Number</button>

<label style="margin-top:12px;display:block;">Transaction ID</label>
<input id="txid" placeholder="Enter Transaction ID">

<button class="submit-btn" onclick="submitPayment()">Submit Request</button>

</div>
</div>

<!-- Bottom Menu -->
<div class="bottom-menu">
    <div onclick="openHome()">üè† <br> Home</div>
    <div onclick="openAddMoney()">‚ûï <br> Add Money</div>
    <div onclick="openOrders()">üì¶ <br> My Orders</div>
    <div onclick="openCodes()">üéÅ <br> Lottery</div>
    <div onclick="openProfile()">üë§ <br> Account</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyBl0PIm4lvZea96Bte3KaKQJvurGE1P8Es",
    authDomain: "post-c7e41.firebaseapp.com",
    databaseURL:"https://post-c7e41-default-rtdb.firebaseio.com",
    projectId: "post-c7e41"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.firestore();
const rtdb = firebase.database();
const auth = firebase.auth();

/* ====== PAGE LOADING CONTROL ====== */
function showLoading(text="Please Wait...") {
    let overlay=document.getElementById("loadingOverlay");
    overlay.style.display="flex";
    overlay.innerHTML="‚è≥ "+text;
}
function hideLoading(){
    document.getElementById("loadingOverlay").style.display="none";
}

/* ===== POPUP ===== */
function showPopup(msg){
    let box = document.getElementById("customPopup");
    document.getElementById("popupMessage").innerText = msg;
    box.style.display = "block";
    setTimeout(()=>{
        box.style.opacity = "1";
        box.style.transform = "translate(-50%, -50%) scale(1)";
    }, 10);
}
function closePopup(){
    let box = document.getElementById("customPopup");
    box.style.opacity = "0";
    box.style.transform = "translate(-50%, -50%) scale(0.8)";
    setTimeout(()=>{ box.style.display = "none"; }, 250);
}

/* NAVIGATION */
function openHome(){ location.href="index.html"; }
function openAddMoney(){ location.href="add_money.html"; }
function openOrders(){ location.href="orders.html"; }
function openCodes(){ location.href="lottery.html"; }
function openProfile(){ location.href="profile.html"; }

/* LOGIN CHECK */
auth.onAuthStateChanged(user=>{
    if(!user){
        showPopup("Please Login First!");
        setTimeout(()=>{ window.location.href="login.html"; },1500);
    } else {
        loadWallet(user.uid);
        loadNumbers();
    }
});

/* LOAD WALLET */
function loadWallet(uid){
    rtdb.ref("wallet/"+uid+"/dollar").on("value",snap=>{
        document.getElementById("myDeposit").innerText =
            "Your Deposit Balance: " + (snap.val() || 0) + " TK";
    });
}

/* PAYMENT METHOD */
let method = "bkash";
let numbers = { bkash:null, nagad:null };

function loadNumbers(){
    db.collection("paymentNumbers").doc("bkash").onSnapshot(d=>{
        numbers.bkash = d.exists ? d.data().number : null;
        if(method==="bkash") showNumber();
        hideLoading(); // loading done
    });
    db.collection("paymentNumbers").doc("nagad").onSnapshot(d=>{
        numbers.nagad = d.exists ? d.data().number : null;
        if(method==="nagad") showNumber();
    });
}

function setMethod(m){
    method = m;
    document.getElementById("bkashTab").classList.remove("active");
    document.getElementById("nagadTab").classList.remove("active");
    document.getElementById(m+"Tab").classList.add("active");
    showNumber();
}

function showNumber(){
    let inp = document.getElementById("payNumber");
    if (!numbers[method]){
        inp.value = "";
        inp.placeholder = "Loading...";
        return;
    }
    inp.value = numbers[method];
}

function copyNumber(){
    let val = document.getElementById("payNumber").value;
    if(!val) return showPopup("Number Not Found");
    navigator.clipboard.writeText(val);
    showPopup("Copied!");
}

/* SUBMIT PAYMENT */
function submitPayment(){
    let amount = Number(document.getElementById("amount").value);
    let phone = document.getElementById("userPhone").value.trim();
    let txid = document.getElementById("txid").value.trim();

    if(amount < 10) return showPopup("Minimum 10 TK");
    if(phone.length < 10) return showPopup("Valid Mobile Number ‡¶¶‡¶ø‡¶®");
    if(!txid) return showPopup("Transaction ID ‡¶¶‡¶ø‡¶®");
    if(!numbers[method]) return showPopup("Payment number missing");

    const user = auth.currentUser;
    if(!user) return showPopup("Login first");

    showLoading("Submitting... Please Wait...");

    setTimeout(()=>{   // 3 seconds waiting
        db.collection("addMoney").add({
            uid: user.uid,
            amount,
            method,
            number: numbers[method],
            userPhone: phone,
            txid,
            status: "pending",
            time: firebase.firestore.FieldValue.serverTimestamp()
        }).then(()=>{
            hideLoading();
            showPopup("Request Submitted!");
            setTimeout(()=>{ location.href="index.html"; },1500);
        });
    }, 3000);
}

</script>

</body>
</html>