<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Add Money</title>

<style>
body{
    font-family:Arial;
    background:#0a0a0a;
    color:#fff;
    margin:0;
    padding:0;
}
.container{
    max-width:480px;
    margin:auto;
    padding:20px;
}
.card{
    background:#141414;
    padding:20px;
    border-radius:12px;
    box-shadow:0 0 10px #000;
}
h2{text-align:center;margin-bottom:12px}
input{
    width:100%;
    padding:12px;
    border-radius:8px;
    border:1px solid #333;
    background:#1c1c1c;
    color:#fff;
    margin-top:8px;
    font-size:15px
}
.method-box{
    display:flex;
    gap:8px;
    margin-top:12px
}
.method{
    flex:1;
    padding:12px;
    border-radius:10px;
    text-align:center;
    cursor:pointer;
    background:#222;
    border:2px solid transparent
}
.method.active{
    border-color:#ff0066
}
.copy-btn, .submit-btn{
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:8px;
    background:#333;
    border:none;
    color:#fff;
    cursor:pointer
}
.submit-btn{
    background:#ff0066;
    font-weight:700
}
.hint{
    font-size:13px;
    opacity:.8;
    margin-top:10px
}
</style>
</head>
<body>

<div class="container">
<div class="card">

<h2>Add Money</h2>

<!-- üîµ USER BALANCE -->
<p id="myDeposit" style="font-size:14px; margin-top:5px; color:#00eaff;">
    Your Deposit Balance: Loading...
</p>

<label>Amount</label>
<input id="amount" type="number" placeholder="Enter Amount">

<div class="method-box">
    <div id="bkashTab" class="method active" onclick="setMethod('bkash')">Bkash</div>
    <div id="nagadTab" class="method" onclick="setMethod('nagad')">Nagad</div>
</div>

<label>Send Money To</label>
<input id="payNumber" readonly placeholder="Loading number...">

<button class="copy-btn" onclick="copyNumber()">Copy Number</button>

<label>Transaction ID</label>
<input id="txid" placeholder="Enter Transaction ID">

<button class="submit-btn" onclick="submitPayment()">Submit Request</button>

<p class="hint">Admin review ‡¶ï‡¶∞‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ balance add ‡¶π‡¶¨‡ßá‡•§</p>

</div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ========= Firebase Config =========
const firebaseConfig = {
    apiKey: "AIzaSyBl0PIm4lvZea96Bte3KaKQJvurGE1P8Es",
    authDomain: "post-c7e41.firebaseapp.com",
    projectId: "post-c7e41",
    databaseURL:"https://post-c7e41-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.firestore();
const rtdb = firebase.database();
const auth = firebase.auth();

let method = "bkash";
let numbers = { bkash: null, nagad: null };

// ========= GET PAYMENT NUMBERS =========
db.collection("paymentNumbers").doc("bkash").onSnapshot(d=>{
    numbers.bkash = d.exists ? d.data().number : null;
    if(method === "bkash") showNumber();
});
db.collection("paymentNumbers").doc("nagad").onSnapshot(d=>{
    numbers.nagad = d.exists ? d.data().number : null;
    if(method === "nagad") showNumber();
});

// ========= Switch Method =========
function setMethod(m){
    method = m;
    document.getElementById("bkashTab").classList.remove("active");
    document.getElementById("nagadTab").classList.remove("active");
    document.getElementById(m+"Tab").classList.add("active");
    showNumber();
}

// ========= Show Number =========
function showNumber(){
    let inp = document.getElementById("payNumber");
    if(numbers[method]){
        inp.value = numbers[method];
    } else {
        inp.value = "";
        inp.placeholder = "Number not set";
    }
}

// ========= Copy Number =========
function copyNumber(){
    const val = document.getElementById("payNumber").value;
    if(!val){
        alert("Number not available");
        return;
    }
    navigator.clipboard.writeText(val);
    alert("Copied!");
}

// ========= SHOW USER DEPOSIT BALANCE (Realtime DB) =========
auth.onAuthStateChanged(user=>{
    if(user){
        rtdb.ref("wallet/" + user.uid + "/dollar").on("value", snap=>{
            let deposit = snap.val() || 0;
            document.getElementById("myDeposit").innerText =
                "Your Deposit Balance: " + deposit + " TK";
        });
    } else {
        document.getElementById("myDeposit").innerText =
            "Your Deposit Balance: Login Required";
    }
});

// ========= Submit Request =========
function submitPayment(){
    let amount = Number(document.getElementById("amount").value);
    let txid = document.getElementById("txid").value.trim();

    if(!amount || amount < 10){
        alert("Minimum 10 TK ‡¶¶‡¶ø‡¶®");
        return;
    }
    if(!txid){
        alert("Transaction ID ‡¶¶‡¶ø‡¶®");
        return;
    }
    if(!numbers[method]){
        alert("Payment Number ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø ‚Äì Admin-‡¶ï‡ßá ‡¶¨‡¶≤‡ßÅ‡¶®");
        return;
    }

    const user = auth.currentUser;
    if(!user){
        alert("Login ‡¶ï‡¶∞‡ßÅ‡¶®");
        return;
    }

    db.collection("addMoney").add({
        uid: user.uid,
        amount: amount,
        method: method,
        number: numbers[method],
        txid: txid,
        status: "pending",
        time: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(()=>{
        alert("Request Submitted!");
        window.location.href = "index.html";
    })
    .catch(err=>{
        alert("Error ‚Äî console ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®");
        console.log(err);
    });
}
</script>

</body>
</html>