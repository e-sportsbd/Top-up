<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Add Money</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{
    font-family:'Poppins', sans-serif;
    margin:0;
    padding:0;
    background:linear-gradient(145deg,#e8f0ff,#fff1f1,#ffe7db);
    color:#222;
    min-height:100vh;
}

/* HEADER */
.header{
    padding:12px 15px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    color:white;
    background:rgba(30,144,255,0.85);
    backdrop-filter:blur(12px);
    box-shadow:0 4px 20px rgba(0,0,0,0.25);
    position:sticky;
    top:0;
    z-index:100;
}
.logo{
    display:flex;
    align-items:center;
    gap:8px;
    font-size:20px;
    font-weight:700;
    cursor:pointer;
}
.logo img{
    height:42px;
}

/* MAIN ADD MONEY CARD */
.container{
    max-width:480px;
    margin:auto;
    padding:18px;
}
.card{
    background:white;
    padding:24px;
    border-radius:18px;
    box-shadow:0 5px 20px rgba(0,0,0,0.15);
}
h2{
    text-align:center;
    margin-bottom:16px;
    font-size:24px;
    font-weight:700;
}
input{
    width:100%;
    padding:14px;
    border-radius:12px;
    border:1px solid #ddd;
    background:#f7f7f7;
    color:#333;
    font-size:15px;
    margin-top:8px;
}
.method-box{
    display:flex;
    gap:12px;
    margin-top:14px;
}
.method{
    flex:1;
    padding:14px;
    background:#f3f6ff;
    border-radius:14px;
    text-align:center;
    border:2px solid transparent;
    cursor:pointer;
    font-weight:600;
}
.method.active{
    border-color:#1e90ff;
    background:#e8f1ff;
    box-shadow:0 0 10px rgba(30,144,255,0.5);
}
.copy-btn, .submit-btn{
    width:100%;
    padding:14px;
    margin-top:12px;
    border-radius:12px;
    font-size:16px;
    border:none;
    cursor:pointer;
    font-weight:700;
}
.copy-btn{
    background:#e1e1e1;
}
.submit-btn{
    background:#1e90ff;
    color:white;
    box-shadow:0 0 12px rgba(30,144,255,0.6);
}
.balance{
    text-align:center;
    font-size:15px;
    color:#1e90ff;
    margin-bottom:12px;
}

/* Bottom Menu */
.bottom-menu{
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:white;
    display:flex;
    justify-content:space-around;
    padding:12px 0;
    box-shadow:0 -4px 18px rgba(0,0,0,0.2);
    z-index:200;
}
.bottom-menu div{
    text-align:center;
    font-size:12px;
    font-weight:700;
    cursor:pointer;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
    <div class="logo" onclick="openHome()">
        <img src="https://i.ibb.co.com/fGt7pS45/Picsart-25-09-30-23-06-37-837.webp">
        <span>TOPUP BD</span>
    </div>
</div>

<!-- ADD MONEY SECTION -->
<div class="container">
<div class="card">

<h2>üí∞ Add Money</h2>

<p id="myDeposit" class="balance">Your Deposit Balance: Loading...</p>

<label>Amount</label>
<input id="amount" type="number" placeholder="Enter Amount">

<label style="margin-top:12px;display:block;">Your Mobile Number</label>
<input id="userPhone" type="number" placeholder="Enter your mobile number">

<div class="method-box">
    <div id="bkashTab" class="method active" onclick="setMethod('bkash')">Bkash</div>
    <div id="nagadTab" class="method" onclick="setMethod('nagad')">Nagad</div>
</div>

<label style="margin-top:12px;display:block;">Send Money To</label>
<input id="payNumber" readonly placeholder="Loading...">

<button class="copy-btn" onclick="copyNumber()">Copy Number</button>

<label style="margin-top:12px;display:block;">Transaction ID</label>
<input id="txid" placeholder="Enter Transaction ID">

<button class="submit-btn" onclick="submitPayment()">Submit Request</button>

</div>
</div>

<!-- Bottom Menu -->
<div class="bottom-menu">
    <div onclick="openHome()">üè† <br> Home</div>
    <div onclick="openAddMoney()">‚ûï <br> Add Money</div>
    <div onclick="openOrders()">üì¶ <br> My Orders</div>
    <div onclick="openCodes()">üéÅ <br> Lottery</div>
    <div onclick="openProfile()">üë§ <br> Account</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyBl0PIm4lvZea96Bte3KaKQJvurGE1P8Es",
    authDomain: "post-c7e41.firebaseapp.com",
    databaseURL:"https://post-c7e41-default-rtdb.firebaseio.com",
    projectId: "post-c7e41"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.firestore();
const rtdb = firebase.database();
const auth = firebase.auth();

// PAGE NAV
function openHome(){ location.href="index.html"; }
function openAddMoney(){ location.href="add_money.html"; }
function openOrders(){ location.href="orders.html"; }
function openCodes(){ location.href="lottery.html"; }
function openProfile(){ location.href="profile.html"; }

// LOGIN CHECK
auth.onAuthStateChanged(user=>{
    if(!user){
        alert("Please Login First!");
        window.location.href = "login.html";
    } else {
        loadWallet(user.uid);
    }
});

// Load Wallet
function loadWallet(uid){
    rtdb.ref("wallet/"+uid+"/dollar").on("value",snap=>{
        document.getElementById("myDeposit").innerText =
            "Your Deposit Balance: " + (snap.val() || 0) + " TK";
    });
}

// PAYMENT METHOD
let method = "bkash";
let numbers = { bkash:null, nagad:null };

// Load Numbers
db.collection("paymentNumbers").doc("bkash").onSnapshot(d=>{
    numbers.bkash = d.exists ? d.data().number : null;
    if(method==="bkash") showNumber();
});
db.collection("paymentNumbers").doc("nagad").onSnapshot(d=>{
    numbers.nagad = d.exists ? d.data().number : null;
    if(method==="nagad") showNumber();
});

function setMethod(m){
    method = m;
    document.getElementById("bkashTab").classList.remove("active");
    document.getElementById("nagadTab").classList.remove("active");
    document.getElementById(m+"Tab").classList.add("active");
    showNumber();
}

function showNumber(){
    let inp = document.getElementById("payNumber");
    if (!numbers[method]){
        inp.value = "";
        inp.placeholder = "Loading...";
        return;
    }
    inp.value = numbers[method];
    inp.placeholder = "";
}

function copyNumber(){
    let val = document.getElementById("payNumber").value;
    if(!val) return alert("Number Not Found");
    navigator.clipboard.writeText(val);
    alert("Copied!");
}

function submitPayment(){
    let amount = Number(document.getElementById("amount").value);
    let phone = document.getElementById("userPhone").value.trim();
    let txid = document.getElementById("txid").value.trim();

    if(amount < 10) return alert("Minimum 10 TK");
    if(phone.length < 10) return alert("Valid Mobile Number ‡¶¶‡¶ø‡¶®");
    if(!txid) return alert("Transaction ID ‡¶¶‡¶ø‡¶®");
    if(!numbers[method]) return alert("Payment number missing");

    const user = auth.currentUser;
    if(!user) return alert("Login first");

    db.collection("addMoney").add({
        uid: user.uid,
        amount,
        method,
        number: numbers[method],
        userPhone: phone,
        txid,
        status: "pending",
        time: firebase.firestore.FieldValue.serverTimestamp()
    }).then(()=>{
        alert("Request Submitted!");
        location.href="index.html";
    });
}
</script>

</body>
</html>