<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Profile</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
/* GLOBAL */
body{
    margin:0;
    background:linear-gradient(160deg,#ffe7db,#fff2f2,#eaf1ff);
    font-family:'Poppins',sans-serif;
}

/* CONTAINER */
.container{
    max-width:780px;
    margin:auto;
    padding:15px;
}

/* BANNER */
.banner{
    width:100%;
    height:220px;
    background:linear-gradient(140deg,#ff5f47,#ff385c,#ff7b36);
    border-bottom-left-radius:30px;
    border-bottom-right-radius:30px;
    position:relative;
    box-shadow:0 6px 25px rgba(255,100,80,0.45);
}

.profile-photo-top{
    width:135px;
    height:135px;
    border-radius:50%;
    border:5px solid white;
    overflow:hidden;
    position:absolute;
    left:50%;
    top:50px;
    transform:translateX(-50%);
    background:#fff;
    display:flex;
    justify-content:center;
    align-items:center;
    box-shadow:0 8px 25px rgba(0,0,0,0.2);
}
.profile-photo-top img{
    width:100%; height:100%; object-fit:cover;
}

/* PROFILE CARD */
.card{
    margin-top:85px;
    background:rgba(255,255,255,0.65);
    backdrop-filter:blur(22px);
    padding:25px;
    border-radius:20px;
    box-shadow:0 10px 35px rgba(0,0,0,0.1);
}

/* TAG */
.tag{
    background:linear-gradient(120deg,#ffe3c5,#ffd7b4);
    padding:6px 14px;
    border-radius:25px;
    font-size:13px;
    display:inline-block;
    color:#ff6b2d;
    font-weight:600;
}

/* NAME, EMAIL, JOIN */
.name{ font-size:23px; font-weight:700; color:#222; }
.email{ opacity:0.7; font-size:14px; }
.join{ opacity:0.6; font-size:13px; }

/* STATS BOX */
.stats{
    display:flex;
    justify-content:space-between;
    margin-top:18px;
}
.stat-box{
    width:48%;
    padding:18px;
    background:white;
    border-radius:18px;
    text-align:center;
    box-shadow:0 6px 20px rgba(0,0,0,0.08);
}
.stat-value{
    font-size:28px;
    font-weight:700;
    background:linear-gradient(120deg,#ff395d,#ff7a32);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}
.stat-text{ opacity:0.7; }

/* ADD MONEY BUTTON */
.add-btn{
    width:100%; margin-top:18px;
    background:linear-gradient(140deg,#ff395d,#ff7a32);
    border:none;
    padding:13px;
    font-size:17px;
    font-weight:600;
    border-radius:14px;
    color:white;
    cursor:pointer;
    box-shadow:0 6px 20px rgba(255,70,50,0.45);
}

/* ACTION BUTTONS */
.action-buttons{
    display:flex;
    gap:12px; margin-top:20px;
}
.logout-btn, .password-btn{
    flex:1;
    padding:12px;
    border:none;
    border-radius:12px;
    color:white;
    font-weight:600;
    cursor:pointer;
    font-size:15px;
}
.logout-btn{
    background:#ff4040;
    box-shadow:0 6px 18px rgba(255,0,0,0.25);
}
.password-btn{
    background:#3862ff;
    box-shadow:0 6px 18px rgba(56,98,255,0.35);
}

/* TRANSACTION TABLE CARD */
.table-card{
    margin-top:30px;
    background:rgba(255,255,255,0.7);
    padding:20px;
    border-radius:20px;
    backdrop-filter:blur(16px);
    box-shadow:0 8px 25px rgba(0,0,0,0.08);
}
.table-card h3{
    margin:0 0 15px 0;
    font-weight:700;
}
table{
    width:100%; border-collapse:collapse;
}
th{
    background:#fff0e9;
    padding:12px;
}
td{
    padding:10px;
    border-bottom:1px solid #eee;
}
.empty{
    opacity:0.6;
    padding:15px;
    text-align:center;
}

/* PASSWORD POPUP */
#passwordPopup{
    position:fixed;
    top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.55);
    display:none;
    justify-content:center;
    align-items:center;
}
#passwordPopup .box{
    background:white;
    width:92%;
    max-width:360px;
    padding:25px;
    border-radius:18px;
    box-shadow:0 10px 30px rgba(0,0,0,0.35);
}
#passwordPopup input{
    width:100%;
    padding:11px;
    border-radius:10px;
    border:1px solid #ccc;
    margin-bottom:13px;
}
</style>
</head>

<body>

<div class="container">

    <div class="banner"></div>

    <!-- PROFILE PHOTO -->
    <div class="profile-photo-top">
        <img id="profilePhoto" src="profile.png">
    </div>

    <!-- MAIN CARD -->
    <div class="card">
        <span class="tag">âœ” Verified Profile</span>

        <div class="name" id="name">Loading...</div>
        <div class="email" id="email"></div>
        <div class="join" id="joindate"></div>

        <!-- STATS -->
        <div class="stats">
            <div class="stat-box">
                <div class="stat-value" id="balance">0</div>
                <div class="stat-text">Balance</div>
            </div>

            <div class="stat-box">
                <div class="stat-value" id="supportPin">------</div>
                <div class="stat-text">Support PIN</div>
            </div>
        </div>

        <button class="add-btn" onclick="openDeposit()">Add Money</button>

        <div class="action-buttons">
            <button class="password-btn" onclick="openPassPopup()">Change Password</button>
            <button class="logout-btn" onclick="logoutNow()">Logout</button>
        </div>
    </div>

    <!-- TRANSACTION TABLE -->
    <div class="table-card">
        <h3>All Transactions</h3>
        <table id="txnTable"></table>
        <div class="empty" id="emptyTxn" style="display:none;">No transactions!</div>
    </div>

</div>

<!-- PASSWORD POPUP -->
<div id="passwordPopup">
    <div class="box">
        <h3>Change Password</h3>

        <input id="oldPass" type="password" placeholder="Old Password">
        <input id="newPass" type="password" placeholder="New Password">
        <input id="confirmPass" type="password" placeholder="Confirm New Password">

        <button style="width:100%;padding:12px;background:#3862ff;color:white;border:none;border-radius:10px;font-size:15px;font-weight:600;"
            onclick="confirmPasswordChange()">Change Now</button>

        <button style="width:100%;padding:11px;margin-top:8px;background:#ddd;border:none;border-radius:10px;"
            onclick="closePassPopup()">Cancel</button>
    </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyBl0PIm4lvZea96Bte3KaKQJvurGE1P8Es",
    authDomain: "noreply@post-c7e41.firebaseapp.com",
    databaseURL: "https://post-c7e41-default-rtdb.firebaseio.com",
    projectId: "post-c7e41",
    messagingSenderId: "758133068153",
    appId: "1:758133068153:web:28ef27e45d8037e0d49fa8"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.database();

/* LOAD USER INFO */
auth.onAuthStateChanged(user=>{
    if(!user){
        window.location.href="login.html";
        return;
    }

    document.getElementById("name").innerText=user.displayName || "User";
    document.getElementById("email").innerText=user.email;
    document.getElementById("joindate").innerText="Joined: " + user.metadata.creationTime;

    if(user.photoURL){
        document.getElementById("profilePhoto").src=user.photoURL;
    }

    loadWallet(user.uid);
    loadTransactions(user.uid);
});

/* LOAD WALLET */
function loadWallet(uid){
    db.ref("wallet/"+uid).on("value",snap=>{
        const d=snap.val() || {};
        document.getElementById("balance").innerText=d.dollar || 0;
        document.getElementById("supportPin").innerText=d.pin || "------";
    });
}

/* LOAD TRANSACTIONS */
function loadTransactions(uid){
    const table=document.getElementById("txnTable");
    const empty=document.getElementById("emptyTxn");

    table.innerHTML=`
    <tr>
        <th>Type</th>
        <th>Amount</th>
        <th>Date</th>
    </tr>`;

    db.ref("transactions/"+uid).on("value",snap=>{
        if(!snap.exists()){
            empty.style.display="block";
            table.style.display="none";
            return;
        }

        empty.style.display="none";
        table.style.display="table";

        snap.forEach(txn=>{
            table.innerHTML+=`
            <tr>
                <td>${txn.val().type}</td>
                <td>${txn.val().amount}</td>
                <td>${txn.val().date}</td>
            </tr>`;
        });
    });
}

/* REDIRECT */
function openDeposit(){ window.location.href="add_money.html"; }

/* LOGOUT */
function logoutNow(){
    auth.signOut().then(()=>{
        alert("Logged out!");
        window.location.href="login.html";
    });
}

/* POPUP CONTROL */
function openPassPopup(){ document.getElementById("passwordPopup").style.display="flex"; }
function closePassPopup(){ document.getElementById("passwordPopup").style.display="none"; }

/* PASSWORD CHANGE */
function confirmPasswordChange(){
    const oldPass=document.getElementById("oldPass").value;
    const newPass=document.getElementById("newPass").value;
    const confirmPass=document.getElementById("confirmPass").value;

    if(!oldPass || !newPass || !confirmPass){
        alert("Please fill all fields!");
        return;
    }
    if(newPass !== confirmPass){
        alert("Password does not match!");
        return;
    }
    if(newPass.length < 6){
        alert("Password must be at least 6 characters!");
        return;
    }

    const user=auth.currentUser;
    const credential=firebase.auth.EmailAuthProvider.credential(user.email, oldPass);

    user.reauthenticateWithCredential(credential)
        .then(()=>user.updatePassword(newPass))
        .then(()=>{
            alert("Password changed successfully!");
            closePassPopup();
        })
        .catch(err=>alert("Error: "+err.message));
}
</script>

</body>
</html>