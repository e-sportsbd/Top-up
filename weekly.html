<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weekly Packages</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    background:linear-gradient(140deg,#ffe7db,#fff1f1,#e7f0ff);
    font-family:'Poppins', sans-serif;
    min-height:100vh;
    padding-bottom:160px;
}

/* Header */
.header{
    padding:12px 18px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:rgba(30,144,255,0.85);
    color:white;
    box-shadow:0 4px 18px rgba(0,0,0,0.25);
}
.logo{
    display:flex;
    align-items:center;
    gap:10px;
    font-size:22px;
    font-weight:700;
}
.logo img{ height:42px; }

.balance-box{
    background:rgba(255,255,255,0.85);
    padding:7px 16px;
    border-radius:30px;
    color:#1e90ff;
    display:flex;
    align-items:center;
    gap:7px;
    font-weight:700;
    box-shadow:0 2px 10px rgba(0,0,0,0.25);
}

.login-btn{
    background:white;
    padding:7px 16px;
    border-radius:25px;
    color:#1e90ff;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 2px 10px rgba(0,0,0,0.25);
}
.profile-img{
    width:45px;
    height:45px;
    border-radius:50%;
    border:2px solid white;
}

/* Sections */
.section{
    background:rgba(255,255,255,0.55);
    margin:18px;
    padding:22px;
    border-radius:20px;
    box-shadow:0 4px 18px rgba(0,0,0,0.12);
}
.section-title{
    font-size:20px;
    font-weight:700;
    margin-bottom:16px;
    color:#082857;
}

/* Packages */
.pack-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:15px;
}
.pack{
    background:rgba(255,255,255,0.75);
    border-radius:18px;
    padding:18px 10px;
    text-align:center;
    font-weight:600;
    cursor:pointer;
    border:2px solid transparent;
    transition:.25s;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
.pack.active{
    border:2px solid #1e90ff;
    background:rgba(30,144,255,0.15);
}

/* Input */
.input-box{
    width:100%;
    padding:17px;
    font-size:17px;
    border-radius:16px;
    border:2px solid #d6deed;
    background:rgba(255,255,255,0.65);
}
.input-box:focus{
    border-color:#1e90ff;
    background:white;
    box-shadow:0 0 12px rgba(30,144,255,0.35);
}

/* Payments */
.paybox{
    flex:1;
    background:rgba(255,255,255,0.7);
    padding:17px;
    border-radius:16px;
    border:2px solid transparent;
    text-align:center;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 4px 12px rgba(0,0,0,0.12);
}
.paybox.active{
    border-color:#1e90ff;
    background:rgba(30,144,255,0.20);
}

/* Buy Button */
.buy-btn{
    width:100%;
    padding:18px;
    font-size:19px;
    border:none;
    border-radius:16px;
    margin-top:22px;
    font-weight:700;
    background:#1e90ff;
    color:white;
    cursor:pointer;
    box-shadow:0 4px 15px rgba(0,0,0,0.25);
}

/* Help */
.call-btn{
    position:fixed;
    right:15px;
    bottom:110px;
    width:70px;
    height:70px;
    background:#ff4b4b;
    border-radius:50%;
    color:white;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    font-size:16px;
}

/* Popup */
.popup-bg{
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.4);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:99999;
}
.popup-box{
    background:white;
    width:75%;
    padding:25px;
    text-align:center;
    border-radius:16px;
    box-shadow:0 4px 20px rgba(0,0,0,0.3);
    animation:pop .25s ease-out;
}
.popup-btn{
    margin-top:18px;
    padding:10px 20px;
    background:#1e90ff;
    border:none;
    color:white;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
}
@keyframes pop{
    0%{ transform:scale(0.5); opacity:0; }
    100%{ transform:scale(1); opacity:1; }
}

/* Blur Loader */
#pageBlur{
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(255,255,255,0.6);
    backdrop-filter: blur(6px);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:999999;
    font-size:22px;
    color:#1e90ff;
    font-weight:700;
}
</style>
</head>

<body>

<!-- GLOBAL BLUR -->
<div id="pageBlur">‚è≥ Please Wait...Loading...</div>

<!-- Popup -->
<div id="popup" class="popup-bg">
    <div class="popup-box">
        <div id="popupMsg" style="font-size:18px; font-weight:600; color:#082857;"></div>
        <button class="popup-btn" onclick="closePopup()">OK</button>
    </div>
</div>

<script>
function showPopup(msg){
    popupMsg.innerText = msg;
    popup.style.display = "flex";
}
function closePopup(){
    popup.style.display = "none";
}
</script>

<!-- HEADER -->
<div class="header">
    <div class="logo">
        <img src="logo.png">
        EASY TOPUP
    </div>

    <div id="balanceBox" class="balance-box" style="display:none;">
        <img src="wallet.png" width="22">
        <span id="walletBalance">0‡ß≥</span>
    </div>

    <div id="loginButton" class="login-btn" onclick="go('login.html')">Login</div>

    <img id="userPhoto" class="profile-img" src="profile.png" style="display:none;">
</div>

<!-- PACKAGES -->
<div class="section">
    <div class="section-title">‡ßß) Weekly Packages</div>
    <div id="packageList" class="pack-grid"></div>
</div>

<!-- UID -->
<div class="section">
    <div class="section-title">‡ß®) Account Info</div>
    <input id="playerId" type="number" class="input-box" placeholder="Free Fire UID ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
</div>

<!-- PAYMENT -->
<div class="section">
    <div class="section-title">‡ß©) Select Payment</div>

    <div style="display:flex;gap:15px;">
        <div id="walletBox" class="paybox" onclick="selectMethod('wallet')">Wallet Pay</div>
        <div id="autoBox" class="paybox" onclick="selectMethod('auto')">Instant Pay</div>
    </div>

    <button onclick="buyNow()" class="buy-btn">Buy Now</button>
</div>

<div class="call-btn" onclick="go('support.html')">Help</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBl0PIm4lvZea96Bte3KaKQJvurGE1P8Es",
  authDomain: "post-c7e41.firebaseapp.com",
  databaseURL: "https://post-c7e41-default-rtdb.firebaseio.com/",
  projectId: "post-c7e41",
  messagingSenderId: "758133068153",
  appId: "1:758133068153:web:5513a1de83491c81776084"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

function go(p){ location.href = p; }

/* ----------------------------------------
   AUTO BLUR REMOVE WHEN ALL DATA LOADED
-----------------------------------------*/
let loaded = {
    auth:false,
    wallet:false,
    products:false
};

function checkLoaded(){
    if(loaded.auth && loaded.products && loaded.wallet){
        pageBlur.style.display = "none";
    }
}

/* AUTH */
auth.onAuthStateChanged(user=>{
    loaded.auth = true;
    checkLoaded();

    if(user){
        loginButton.style.display="none";
        balanceBox.style.display="flex";
        userPhoto.style.display="block";
        userPhoto.src = user.photoURL || "profile.png";
        loadWallet(user.uid);
    } else {
        loaded.wallet = true;
        checkLoaded();
    }
});

/* Wallet */
let currentWallet = 0;
function loadWallet(uid){
    db.ref("wallet/"+uid).on("value",snap=>{
        let d = snap.val() || {};
        currentWallet = d.dollar || 0;
        walletBalance.innerText = currentWallet + "‡ß≥";

        loaded.wallet = true;
        checkLoaded();
    });
}

/* Weekly Packages */
db.ref("products/weekly").on("value", snap=>{
    const box = document.getElementById("packageList");
    box.innerHTML = "";

    snap.forEach(p=>{
        let pkg = p.val();

        let div = document.createElement("div");
        div.className = "pack";
        div.dataset.key = p.key;

        div.innerHTML = `
            <div class='title'>${pkg.title}</div>
            <div class='diamond'>üíé ${pkg.diamonds}</div>
            <div class='price'>BDT ${pkg.price}</div>
        `;

        div.addEventListener("click", ()=>selectPackage(div,p.key,pkg));
        box.appendChild(div);
    });

    loaded.products = true;
    checkLoaded();
});

/* Select Package */
let selectedPackage = null;
let selectedDiv = null;

function selectPackage(div,key,pkg){
    if(selectedDiv) selectedDiv.classList.remove("active");
    div.classList.add("active");
    selectedDiv = div;
    selectedPackage = { key, ...pkg };
}

/* Select Payment */
let payMethod = null;
function selectMethod(type){
    payMethod = type;
    document.querySelectorAll(".paybox").forEach(x=>x.classList.remove("active"));
    document.getElementById(type==="wallet"?"walletBox":"autoBox").classList.add("active");
}

/* BUY */
function buyNow(){
    let user = auth.currentUser;
    if(!user) return showPopup("‚ö†Ô∏è Login First!");
    if(!selectedPackage) return showPopup("‚ö†Ô∏è Package Select ‡¶ï‡¶∞‡ßÅ‡¶®");
    if(!playerId.value || playerId.value.length < 3) return showPopup("‚ö†Ô∏è UID ‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®");
    if(!payMethod) return showPopup("‚ö†Ô∏è Payment Select ‡¶ï‡¶∞‡ßÅ‡¶®");

    let price = selectedPackage.price;

    if(payMethod==="wallet"){
        if(currentWallet < price) return showPopup("‚ö†Ô∏è Wallet ‡¶è ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶®‡ßá‡¶á!");
    }

    /* ---- INSTANT LOADING ---- */
    pageBlur.innerText = "‚è≥ Processing...";
    requestAnimationFrame(()=>{
        pageBlur.style.display="flex";

        setTimeout(()=>{

            if(payMethod==="wallet"){
                db.ref("wallet/"+user.uid).update({ dollar: currentWallet - price });
            }

            let order = {
                uid:user.uid,
                playerId:playerId.value,
                package:selectedPackage,
                price:price,
                payMethod:payMethod,
                status:"Pending",
                time:Date.now()
            };

            db.ref("orders").push(order);

            pageBlur.style.display="none";
            showPopup("‚úÖ Order Submitted!");

            setTimeout(()=>location.reload(),1500);

        },3000);
    });
}
</script>

</body>
</html>