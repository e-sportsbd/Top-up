<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Level Up Pass</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    background:linear-gradient(140deg,#ffe7db,#fff1f1,#e7f0ff);
    font-family:'Poppins', sans-serif;
    min-height:100vh;
    padding-bottom:160px;
}

/* ================= GLOBAL LOADING POPUP ================= */
#loadingOverlay{
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(255,255,255,0.6);
    backdrop-filter:blur(6px);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:22px;
    font-weight:700;
    color:#1e90ff;
    z-index:999999;
}

/* ======================================================== */
/* HEADER */
.header{
    padding:12px 18px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:rgba(30,144,255,0.85);
    color:white;
    box-shadow:0 4px 18px rgba(0,0,0,0.25);
}
.logo{ display:flex; align-items:center; gap:10px; font-size:22px; font-weight:700; }
.logo img{ height:42px; }

.balance-box{
    background:rgba(255,255,255,0.85);
    padding:7px 16px;
    border-radius:30px;
    color:#1e90ff;
    display:flex;
    align-items:center;
    gap:7px;
    font-weight:700;
    box-shadow:0 2px 10px rgba(0,0,0,0.25);
}

.login-btn{
    background:white;
    padding:7px 16px;
    border-radius:25px;
    color:#1e90ff;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 2px 10px rgba(0,0,0,0.25);
}

.profile-img{
    width:45px;
    height:45px;
    border-radius:50%;
    border:2px solid white;
}

/* SECTION */
.section{
    background:rgba(255,255,255,0.55);
    margin:18px;
    padding:22px;
    border-radius:20px;
    box-shadow:0 4px 18px rgba(0,0,0,0.12);
}
.section-title{
    font-size:20px;
    font-weight:700;
    margin-bottom:16px;
    color:#082857;
}

/* PACKAGES */
.pack-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:15px;
}
.pack{
    background:rgba(255,255,255,0.75);
    border-radius:18px;
    padding:18px 10px;
    text-align:center;
    font-weight:600;
    cursor:pointer;
    border:2px solid transparent;
    transition:.25s;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
.pack.active{
    border:2px solid #1e90ff;
    background:rgba(30,144,255,0.15);
}
.pack .title{
    font-size:17px;
    font-weight:700;
}
.pack .diamond{
    font-size:15px;
    color:#ff5050;
    margin:5px 0;
}
.pack .price{
    font-size:17px;
    font-weight:700;
    color:#1e90ff;
}

/* INPUT */
.input-box{
    width:100%;
    padding:17px;
    font-size:17px;
    border-radius:16px;
    border:2px solid #d6deed;
    background:rgba(255,255,255,0.65);
}
.input-box:focus{
    border-color:#1e90ff;
    background:white;
    box-shadow:0 0 12px rgba(30,144,255,0.35);
}

/* PAYMENT */
.paybox{
    flex:1;
    background:rgba(255,255,255,0.7);
    padding:17px;
    border-radius:16px;
    border:2px solid transparent;
    text-align:center;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 4px 12px rgba(0,0,0,0.12);
}
.paybox.active{
    border-color:#1e90ff;
    background:rgba(30,144,255,0.20);
}

.buy-btn{
    width:100%;
    padding:18px;
    font-size:19px;
    border:none;
    border-radius:16px;
    margin-top:22px;
    font-weight:700;
    background:#1e90ff;
    color:white;
    cursor:pointer;
    box-shadow:0 4px 15px rgba(0,0,0,0.25);
}

/* HELP */
.call-btn{
    position:fixed;
    right:15px;
    bottom:110px;
    width:70px;
    height:70px;
    background:#ff4b4b;
    border-radius:50%;
    color:white;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    font-size:16px;
}

/* NAV */
.bottom-nav{
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:rgba(255,255,255,0.95);
    display:flex;
    justify-content:space-around;
    padding:10px 0 15px;
    font-weight:700;
    box-shadow:0 -4px 15px rgba(0,0,0,0.2);
}
.bottom-nav div{
    text-align:center;
    font-size:13px;
    cursor:pointer;
}

/* ALERT */
.alert-overlay{
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.45);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:999;
    display:none;
}
.alert-box{
    background:white;
    width:80%;
    max-width:300px;
    padding:22px;
    border-radius:16px;
    text-align:center;
    box-shadow:0 4px 15px rgba(0,0,0,0.25);
}
.alert-btn{
    background:#1e90ff;
    color:white;
    padding:10px 18px;
    border-radius:10px;
    font-weight:600;
    margin-top:12px;
    display:inline-block;
    cursor:pointer;
}
</style>
</head>

<body>

<!-- GLOBAL LOADING -->
<div id="loadingOverlay">‚è≥ Please Wait‚Ä¶ Loading...</div>

<!-- ALERT POPUP -->
<div id="alertOverlay" class="alert-overlay">
    <div class="alert-box">
        <div id="alertMessage" style="font-size:17px;font-weight:600;color:#082857;"></div>
        <div onclick="closeAlert()" class="alert-btn">OK</div>
    </div>
</div>

<script>
function showAlert(msg){
    document.getElementById("alertMessage").innerText = msg;
    document.getElementById("alertOverlay").style.display = "flex";
}
function closeAlert(){
    document.getElementById("alertOverlay").style.display = "none";
}
</script>

<!-- HEADER -->
<div class="header">
    <div class="logo">
        <img src="logo.png">
        EASY TOPUP
    </div>

    <div id="balanceBox" class="balance-box" style="display:none;">
        <img src="wallet.png" width="22">
        <span id="walletBalance">0‡ß≥</span>
    </div>

    <div id="loginButton" class="login-btn" onclick="go('login.html')">Login</div>

    <img id="userPhoto" class="profile-img" src="profile.png" style="display:none;">
</div>

<!-- PACKAGES -->
<div class="section">
    <div class="section-title">‡ßß) Level Up Pass</div>
    <div id="packageList" class="pack-grid"></div>
</div>

<!-- UID -->
<div class="section">
    <div class="section-title">‡ß®) Account Info</div>
    <input id="playerId" type="number" class="input-box" placeholder="Free Fire UID ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
</div>

<!-- PAYMENT -->
<div class="section">
    <div class="section-title">‡ß©) Select Payment</div>

    <div style="display:flex;gap:15px;">
        <div id="walletBox" class="paybox" onclick="selectMethod('wallet')">Wallet Pay</div>
        <div id="autoBox" class="paybox" onclick="selectMethod('auto')">Instant Pay</div>
    </div>

    <button onclick="buyNow()" class="buy-btn">Buy Now</button>
</div>

<div class="call-btn" onclick="go('support.html')">Help</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBl0PIm4lvZea96Bte3KaKQJvurGE1P8Es",
  authDomain: "post-c7e41.firebaseapp.com",
  databaseURL: "https://post-c7e41-default-rtdb.firebaseio.com/",
  projectId: "post-c7e41",
  messagingSenderId: "758133068153",
  appId: "1:758133068153:web:5513a1de83491c81776084"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

function go(p){ location.href = p; }

/* ===================== AUTO LOADING CONTROL ===================== */
let load1=false, load2=false;

function hideLoading(){
    if(load1 && load2){
        document.getElementById("loadingOverlay").style.display="none";
    }
}

/* LOGIN */
auth.onAuthStateChanged(user=>{
    if(user){
        loginButton.style.display="none";
        balanceBox.style.display="flex";
        userPhoto.style.display="block";
        userPhoto.src = user.photoURL || "profile.png";
        loadWallet(user.uid);
    } else {
        load1 = true;
        hideLoading();
    }
});

/* WALLET */
let currentWallet = 0;
function loadWallet(uid){
    db.ref("wallet/"+uid).on("value",snap=>{
        let d = snap.val() || {};
        currentWallet = d.dollar || 0;
        walletBalance.innerText = currentWallet + "‡ß≥";

        load1 = true;
        hideLoading();
    });
}

/* PACKAGES */
db.ref("products/levelup").on("value", snap=>{
    const box = document.getElementById("packageList");
    box.innerHTML = "";

    snap.forEach(p=>{
        let pkg = p.val();

        let div = document.createElement("div");
        div.className = "pack";
        div.dataset.key = p.key;

        div.innerHTML = `
            <div class='title'>${pkg.title}</div>
            <div class='diamond'>üíé ${pkg.diamonds}</div>
            <div class='price'>BDT ${pkg.price}</div>
        `;

        div.addEventListener("click", ()=>selectPackage(div,p.key,pkg));
        box.appendChild(div);
    });

    load2 = true;
    hideLoading();
});

/* SELECT PACKAGE */
let selectedPackage = null;
let selectedDiv = null;

function selectPackage(div,key,pkg){
    if(selectedDiv) selectedDiv.classList.remove("active");
    div.classList.add("active");
    selectedDiv = div;
    selectedPackage = { key, ...pkg };
}

/* PAYMENT METHOD */
let payMethod = null;
function selectMethod(type){
    payMethod = type;
    document.querySelectorAll(".paybox").forEach(x=>x.classList.remove("active"));
    document.getElementById(type==="wallet"?"walletBox":"autoBox").classList.add("active");
}

/* ========================= BUY NOW ========================= */
function buyNow(){
    let user = auth.currentUser;

    if(!user) return showAlert("Login First!");
    if(!selectedPackage) return showAlert("Package Select ‡¶ï‡¶∞‡ßÅ‡¶®");

    let id = playerId.value;
    if(id.length < 3) return showAlert("UID ‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®");

    if(!payMethod) return showAlert("Payment Select ‡¶ï‡¶∞‡ßÅ‡¶®");

    let price = selectedPackage.price;

    /* SHOW PROCESSING */
    let load = document.getElementById("loadingOverlay");
    load.innerText = "‚è≥ Processing...";
    load.style.display = "flex";

    setTimeout(()=>{

        if(payMethod==="wallet"){
            if(currentWallet < price){
                load.style.display="none";
                return showAlert("Wallet ‡¶è ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶®‡ßá‡¶á!");
            }
            db.ref("wallet/"+user.uid).update({ dollar: currentWallet - price });
        }

        let order = {
            uid:user.uid,
            playerId:id,
            package:selectedPackage,
            price:price,
            payMethod:payMethod,
            status:"Pending",
            time:Date.now()
        };

        db.ref("orders").push(order);

        // Step 1: Change text
        load.innerText = "‚úÖ Order Submitted!";

        // Step 2: 1.5 sec after refresh
        setTimeout(()=>{
            location.reload();
        },1500);

    },3000);
}
</script>

</body>
</html>