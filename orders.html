<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Orders</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    background:linear-gradient(140deg,#ffe7db,#fff1f1,#e7f0ff);
    font-family:'Poppins', sans-serif;
    min-height:100vh;
}

/* üî• LOADING OVERLAY */
#loadingOverlay{
    position:fixed;
    top:0;left:0;
    width:100%;height:100%;
    backdrop-filter:blur(8px);
    background:rgba(255,255,255,0.6);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
    font-size:22px;
    font-weight:700;
    color:#1e90ff;
}

/* HEADER */
.header{
    padding:14px 16px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    color:white;
    background:rgba(30,144,255,0.85);
    backdrop-filter:blur(10px);
    box-shadow:0 4px 15px rgba(0,0,0,0.25);
    position:sticky;
    top:0;
    z-index:10;
}

.logo{
    display:flex;
    align-items:center;
    gap:10px;
    font-size:20px;
    font-weight:600;
}

.logo img{
    height:42px;
}

.balance-box{
    background:rgba(255,255,255,0.85);
    padding:6px 16px;
    color:#1e90ff;
    border-radius:30px;
    font-weight:700;
    display:flex;
    align-items:center;
    gap:6px;
    backdrop-filter:blur(6px);
    box-shadow:0 2px 8px rgba(0,0,0,0.15);
}

.profile-img{
    width:44px;
    height:44px;
    border-radius:50%;
    object-fit:cover;
    border:2px solid #fff;
}

/* TITLE */
.section-title{
    font-size:22px;
    font-weight:700;
    margin:20px 16px 10px;
    color:#2d2d2d;
}

/* ORDER CARD */
.order-card{
    margin:15px;
    background:rgba(255,255,255,0.7);
    padding:18px;
    border-radius:18px;
    backdrop-filter:blur(12px);
    box-shadow:0 4px 15px rgba(0,0,0,0.12);
    border-left:7px solid #1e90ff;
    transition:0.25s;
}

.order-card:hover{
    transform:scale(1.02);
}

.order-card h3{
    margin:0;
    font-size:18px;
    color:#1d3557;
}

.order-card p{
    margin:6px 0;
    font-size:15px;
    color:#2b2b2b;
}

.status{
    padding:6px 14px;
    border-radius:12px;
    font-size:14px;
    font-weight:600;
    display:inline-block;
    margin-top:8px;
}

.pending{ background:#fff7d1; color:#b68a00; }
.success{ background:#d6ffe0; color:#0b8c10; }
.cancel{ background:#ffd4d4; color:#d10000; }

/* BOTTOM NAV */
.bottom-nav{
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:rgba(255,255,255,0.9);
    backdrop-filter:blur(12px);
    box-shadow:0 -3px 15px rgba(0,0,0,0.18);
    display:flex;
    justify-content:space-around;
    padding:10px 0;
    font-weight:600;
    border-radius:18px 18px 0 0;
}

.bottom-nav div{
    text-align:center;
    font-size:13px;
    cursor:pointer;
}
</style>
</head>
<body>

<!-- üî• LOADING POPUP -->
<div id="loadingOverlay">‚è≥ Please wait... Loading...</div>

<!-- HEADER -->
<div class="header">
    <div class="logo" onclick="go('index.html')">
        <img src="logo.png">
        TOPUPBD
    </div>

    <div class="balance-box">
        <img src="wallet.png" width="20">
        <span id="walletBalance">‡ß≥0</span>
    </div>

    <img id="userPhoto" class="profile-img" src="profile.png" onclick="go('profile.html')">
</div>

<div class="section-title">üì¶ My Order History</div>

<div id="orderList"></div>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
    <div onclick="go('index.html')">üè† <br> Home</div>
    <div onclick="go('add_money.html')">‚ûï <br> Add Money</div>
    <div onclick="go('orders.html')">üì¶ <br> Orders</div>
    <div onclick="go('codes.html')">üîë <br> Lottary</div>
    <div onclick="go('profile.html')">üë§ <br> Account</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* Firebase Setup */
const firebaseConfig = {
  apiKey: "AIzaSyBl0PIm4lvZea96Bte3KaKQJvurGE1P8Es",
  authDomain: "post-c7e41.firebaseapp.com",
  databaseURL: "https://post-c7e41-default-rtdb.firebaseio.com",
  projectId: "post-c7e41",
  messagingSenderId: "758133068153",
  appId: "1:758133068153:web:5513a1de83491c81776084"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

function go(p){ window.location.href = p; }

/* üî• Loading control variables */
let walletLoaded = false;
let ordersLoaded = false;

/* Hide Loading When All Done */
function checkLoadingDone(){
    if(walletLoaded && ordersLoaded){
        document.getElementById("loadingOverlay").style.display = "none";
    }
}

/* LOAD USER */
auth.onAuthStateChanged(user=>{
    if(!user){
        alert("Please Login First!");
        go("login.html");
        return;
    }

    document.getElementById("userPhoto").src =
        user.photoURL ? user.photoURL : "profile.png";

    db.ref("wallet/" + user.uid).on("value", snap=>{
        document.getElementById("walletBalance").innerText =
            (snap.val()?.dollar || 0) + "‡ß≥";

        walletLoaded = true;
        checkLoadingDone();
    });

    loadOrders(user.uid);
});

/* LOAD USER ORDERS */
function loadOrders(uid){
    db.ref("users/" + uid + "/orderHistory").on("value", snap=>{
        
        const box = document.getElementById("orderList");
        box.innerHTML = "";

        if(!snap.exists()){
            box.innerHTML = "<h3 style='text-align:center;color:#777;'>No Orders Found</h3>";
            ordersLoaded = true;
            checkLoadingDone();
            return;
        }

        let orders = [];
        snap.forEach(s=>{
            orders.push(s.val());
        });

        orders.reverse();

        orders.forEach(o=>{
            let time = new Date(o.time).toLocaleString();

            let statusClass =
                o.status === "Success" ? "success" :
                o.status === "Cancelled" ? "cancel" : "pending";

            let div = document.createElement("div");
            div.className = "order-card";

            div.innerHTML = `
                <h3>üíé ${o.package.diamonds} ‚Äì ${o.price}‡ß≥</h3>
                <p><b>Player ID:</b> ${o.playerId}</p>
                <p><b>Payment:</b> ${o.payMethod}</p>
                <p><b>Time:</b> ${time}</p>
                <span class="status ${statusClass}">
                    ${o.status}
                </span>
            `;
            box.appendChild(div);
        });

        ordersLoaded = true;
        checkLoadingDone();
    });
}
</script>

</body>
</html>